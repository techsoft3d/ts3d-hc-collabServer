var e={d:(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)},a={};e.d(a,{$:()=>M,$T:()=>x,$j:()=>se,CS:()=>h,O5:()=>E,Vt:()=>V,XG:()=>j,dj:()=>z,f4:()=>J,hy:()=>O,j2:()=>ie,pw:()=>N,vy:()=>P,zP:()=>S});var t,i,n,o=null,s=!1,l=!1,c=!1,r=!1,d=!1,u=!1,m=!1,b=!1,f=!1,w=!1,C=!1,p=!1,v=!1,g="",k=null,y=null;function M(){return!!o}function S(){o&&(o.disconnect(),o=null),p=!1,v=!1}function h(){if(o)return{id:o.id,name:t}}function P(){return p}function N(){return v}function x(){!o||p||v||o.emit("lockSession",""),p=!0}function J(){o&&p&&o.emit("unlockSession",""),p=!1}function V(e){o.emit("chatmessage",JSON.stringify({user:t,message:e}))}function j(e){C=e}function O(e){return C}function z(e){o&&(e.type="custommessage",e.user=t,o.emit("hcmessage",JSON.stringify(e)))}function F(e,a){o&&(a.type=e,a.user=t,o.emit("hcmessage",JSON.stringify(a)))}function E(e){y=e}function I(e){s||!o||C||v?s=!1:F("camera",{camera:e.toJson()})}function D(e){if(!o||C||l||v)l=!1;else{let e=[],a=hwv.selectionManager.getResults();for(let t=0;t<a.length;t++)e.push(a[t].toJson());F("selection",{selection:e})}}async function L(e,a,t){return!o||C||c||v?c=!1:F("visibility",{nodeids:e,onoff:a}),await i.model.setNodesVisibilityCollab(e,a,t)}async function W(){return!o||C||c||v?c=!1:F("resetvisibilities",{}),await i.model.resetNodesVisibilityCollab()}async function B(e){return!o||C||v||F("setdrawmode",{drawmode:e}),await i.view.setDrawModeCollab(e)}async function _(e){return!o||C||r||v||F("setprojectionmode",{projectionmode:e}),await i.view.setProjectionModeCollab(e)}async function A(){return!o||C||v||F("reset",{}),await i.model.resetCollab()}async function H(){return!o||C||v||F("clear",{}),await i.model.clearCollab()}async function U(e,a){return!o||C||d||v?d=!1:(a.toJson(),F("matrix",{nodeid:e,matrix:a.toJson()})),await i.model.setNodeMatrixCollab(e,a)}async function q(e,a,t,n){return!o||C||u||v?u=!1:F("isolate",{nodeids:e,duration:a,fitNodes:t,initiallyHidden:n}),await i.view.isolateNodesCollab(e,0,t,n)}async function G(e,a){return!o||C||m||v?m=!1:F("cadview",{nodeid:e,duration:a}),await i.model.activateCadViewCollab(e,a)}async function R(e){return!o||C||b||v?b=!1:F("explodemagnitude",{magnitude:e}),await i.explodeManager.setMagnitudeCollab(e)}function T(e){!o||C||v||F("markup",{id:e.getUniqueId(),info:i.markupManager.exportMarkup()})}function X(){!o||C||v||F("markup",{id:i.markupManager.getActiveMarkupView().getUniqueId(),info:i.markupManager.exportMarkup()})}function K(){!o||C||v||F("markup",{id:null,info:i.markupManager.exportMarkup()})}async function Q(e){!o||C||f||v?f=!1:F("activatemarkupview",{id:e}),i.unsetCallbacks({camera:I}),await i.markupManager.activateMarkupViewWithPromiseCollab(e,0),i.setCallbacks({camera:I})}async function Y(e,a){!o||C||w||v||F("cuttingsection",{id:e,active:!0,csinfo:a.toJson()}),await a.activateCollab()}async function Z(e,a){if(o&&!C&&!w&&!v){F("cuttingsection",{id:e,active:!1,csinfo:a.toJson()})}await a.deactivateCollab()}async function ee(e,a,t,i,n,s,l){await a.updatePlaneCollab(t,i,n,s,l),!o||C||w||v||F("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function ae(e,a,t,i,n){await a.setPlaneCollab(t,i,n),!o||C||w||v||F("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function te(e,a,t){!o||C||v||F("loadsubtree",{a:e,b:a,c:t}),await i.model.loadSubtreeFromScsFileCollab(e,a,t)}function ie(e,a,t){n=t,i=e,k=a,e.setCallbacks({camera:I,selectionArray:D,viewCreated:T,redlineCreated:X,measurementCreated:K}),e.view.setProjectionModeCollab=e.view.setProjectionMode,e.view.setProjectionMode=_,e.view.setDrawModeCollab=e.view.setDrawMode,e.view.setDrawMode=B,e.markupManager.activateMarkupViewWithPromiseCollab=e.markupManager.activateMarkupViewWithPromise,e.markupManager.activateMarkupViewWithPromise=Q,e.model.loadSubtreeFromScsFileCollab=e.model.loadSubtreeFromScsFile,e.model.loadSubtreeFromScsFile=te,e.model.setNodesVisibilityCollab=e.model.setNodesVisibility,e.model.setNodesVisibility=L,e.explodeManager.setMagnitudeCollab=e.explodeManager.setMagnitude,e.explodeManager.setMagnitude=R,e.model.resetNodesVisibilityCollab=e.model.resetNodesVisibility,e.model.resetNodesVisibility=W,e.model.resetCollab=e.model.reset,e.model.reset=A,e.model.clearCollab=e.model.clear,e.model.clear=H,e.model.setNodeMatrixCollab=e.model.setNodeMatrix,e.model.setNodeMatrix=U,e.view.isolateNodesCollab=e.view.isolateNodes,e.view.isolateNodes=q,e.model.activateCadViewCollab=e.model.activateCadView,e.model.activateCadView=G;let s=e.cuttingManager.getCuttingSection(0),l=e.cuttingManager.getCuttingSection(1),c=e.cuttingManager.getCuttingSection(2);if(s&&(s.activateCollab=s.activate,s.activate=function(){Y(0,this)},s.deactivateCollab=s.deactivate,s.deactivate=function(){Z(0,this)},s.updatePlaneCollab=s.updatePlane,s.updatePlane=function(e,a,t,i,n){ee(0,this,e,a,t,i,n)},s.setPlaneCollab=s.setPlane,s.setPlane=function(e,a,t){ae(0,this,e,a,t)}),l&&(l.activateCollab=l.activate,l.activate=function(){Y(1,this)},l.deactivateCollab=l.deactivate,l.deactivate=function(){Z(1,this)},l.updatePlaneCollab=l.updatePlane,l.updatePlane=function(e,a,t,i,n){ee(1,this,e,a,t,i,n)},l.setPlaneCollab=l.setPlane,l.setPlane=function(e,a,t){ae(1,this,e,a,t)}),c&&(c.activateCollab=c.activate,c.activate=function(){Y(2,this)},c.deactivateCollab=c.deactivate,c.deactivate=function(){Z(2,this)},c.updatePlaneCollab=c.updatePlane,c.updatePlane=function(e,a,t,i,n){ee(2,this,e,a,t,i,n)},c.setPlaneCollab=c.setPlane,c.setPlane=function(e,a,t){ae(2,this,e,a,t)}),k){var r=$("#ui-modelbrowser-minimizebutton");r&&r.on("click",(function(){!o||C||v||($(this).hasClass("minimized")?F("minimizebrowser",{}):F("maximizebrowser",{}))}))}}var ne=[],oe=!1;async function se(e,a,u){t=a;let C={username:a,roomname:e,password:u};(o=await io(n)).emit("joinroom",JSON.stringify(C)),o.on("hcmessage",(async function(e){let a=JSON.parse(e);if(!y||y(a))switch(a.type){case"camera":case"setprojectionmode":case"selection":case"setdrawmode":case"activatemarkupview":case"markup":case"loadsubtree":case"visibility":case"explodemagnitude":case"resetvisibilities":case"reset":case"clear":case"matrix":case"isolate":case"cadview":case"cuttingsection":case"minimizebrowser":case"maximizebrowser":!function(e){ne.push(e);{let e=setInterval((async function(){if(ne.length>0){if(!oe){oe=!0;let e=ne.shift();await async function(e){switch(e.type){case"camera":{let a=Communicator.Camera.fromJson(e.camera);s=!0,await i.view.setCamera(a)}break;case"setprojectionmode":await i.view.setProjectionModeCollab(e.projectionmode);break;case"selection":{let a=e.selection;l=!0,i.selectionManager.clear();let t=[];for(let e=0;e<a.length;e++){let i,n,o;a[e].faceEntity&&(i=Communicator.Selection.FaceEntity.fromJson(a[e].faceEntity)),a[e].lineEntity&&(n=Communicator.Selection.LineEntity.fromJson(a[e].lineEntity)),a[e].pointEntity&&(o=Communicator.Selection.PointEntity.fromJson(a[e].pointEntity));let s=new Communicator.Selection.SelectionItem.create(a[e].nodeId,null,i,n,o);t.push(s)}for(let e=0;e<t.length;e++)l=!0,await i.selectionManager.add(t[e])}break;case"setdrawmode":await i.view.setDrawModeCollab(e.drawmode);break;case"activatemarkupview":f=!0,i.unsetCallbacks({camera:I}),await i.markupManager.activateMarkupViewWithPromise(e.id,0),i.setCallbacks({camera:I});break;case"markup":i.unsetCallbacks({viewCreated:T}),i.unsetCallbacks({redlineCreated:T}),i.markupManager.deleteMarkupView(e.id),await i.markupManager.loadMarkupData(e.info),e.id&&i.markupManager.activateMarkupView(e.id),i.markupManager.refreshMarkup(),i.setCallbacks({viewCreated:T}),i.setCallbacks({redlineCreated:T});break;case"loadsubtree":r=!0,s=!0,i.unsetCallbacks({camera:I}),await hwv.model.loadSubtreeFromScsFileCollab(e.a,e.b,e.c),i.setCallbacks({camera:I}),r=!1,s=!1;break;case"visibility":c=!0,await i.model.setNodesVisibility(e.nodeids,e.onoff);break;case"explodemagnitude":b=!0,await i.explodeManager.setMagnitude(e.magnitude);break;case"resetvisibilities":c=!0,w=!0,await i.model.resetNodesVisibility();break;case"reset":i.model.resetCollab();break;case"clear":s=!0,r=!0,i.unsetCallbacks({camera:I}),await i.model.clearCollab(),i.setCallbacks({camera:I}),r=!1,s=!1;break;case"matrix":d=!0,await i.model.setNodeMatrix(e.nodeid,Communicator.Matrix.fromJson(e.matrix));break;case"isolate":s=!0,w=!0,await i.view.isolateNodesCollab(e.nodeids,0,null!=e.fitNodes?e.fitNodes:void 0,null!=e.initiallyHidden?e.initiallyHidden:void 0);break;case"cadview":m=!0,i.model.activateCadView(e.nodeid,null!=e.duration?e.duration:void 0);break;case"cuttingsection":{let a=i.cuttingManager.getCuttingSection(e.id);e.active?(w=!0,d=!0,await a.fromJson(e.csinfo)):a.deactivateCollab(),w=!1}break;case"minimizebrowser":await k._modelBrowser._minimizeModelBrowser();break;case"maximizebrowser":await k._modelBrowser._maximizeModelBrowser()}}(e),oe=!1}}else clearInterval(e),e=null}),10)}}(a)}})),o.on("initialState",(function(e){let a=JSON.parse(e);if(a.type="initialState",(!y||y(a))&&a.camera){let e=Communicator.Camera.fromJson(a.camera);s=!0,i.view.setCamera(e)}})),o.on("sendInitialState",(function(e){let a={type:"sendInitialState",camera:i.view.getCamera().toJson()};y&&!y(a)||o.emit("initialState",JSON.stringify({recepient:e,state:a}))})),o.on("lockSession",(function(e){y&&!y({user:e,type:"lockSession"})||(g=e,v=!0)})),o.on("unlockSession",(function(e){y&&!y({type:"unlockSession"})||(v=!1)})),o.on("disconnect",(()=>{g="",v=!1,S(),y&&y({type:"connectionLost"})})),o.on("disconnected",(function(e){e==g&&1==v&&(g="",v=!1),y&&y({user:e,type:"disconnected"})})),o.on("chatmessage",(function(e){let a=JSON.parse(e);a.type="chatmessage",y&&y(a)})),o.on("userlist",(function(e){let a=JSON.parse(e);a.type="userlist",y&&y(a)}))}var le=a.$j,ce=a.zP,re=a.$,de=a.CS,ue=a.pw,me=a.vy,be=a.hy,fe=a.j2,we=a.$T,Ce=a.dj,pe=a.O5,ve=a.XG,ge=a.Vt,ke=a.f4;export{le as connect,ce as disconnect,re as getActive,de as getLocalUser,ue as getLockedClient,me as getLockedMaster,be as getSuspendSend,fe as initialize,we as lockSession,Ce as sendCustomMessage,pe as setMessageReceivedCallback,ve as setSuspendSend,ge as submitChat,ke as unlockSession};