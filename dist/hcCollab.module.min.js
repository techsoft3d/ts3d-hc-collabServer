var e={d:(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)},a={};e.d(a,{$T:()=>h,$j:()=>ee,CS:()=>M,O5:()=>j,Vt:()=>N,XG:()=>J,dj:()=>V,f4:()=>P,j2:()=>Z,pw:()=>S,vy:()=>y,zP:()=>k});var t,i,o=null,n=!1,s=!1,l=!1,r=!1,c=!1,d=!1,u=!1,m=!1,b=!1,f=!1,C=!1,p=!1,w="",v=null,g=null;function k(){o&&(o.disconnect(),o=null),C=!1,p=!1}function M(){if(o)return{id:o.id,name:t}}function y(){return C}function S(){return p}function h(){!o||C||p||o.emit("lockSession",""),C=!0}function P(){o&&C&&o.emit("unlockSession",""),C=!1}function N(e){o.emit("chatmessage",JSON.stringify({user:t,message:e}))}function J(e){f=e}function V(e){o&&(e.type="custommessage",e.user=t,o.emit("hcmessage",JSON.stringify(e)))}function x(e,a){o&&(a.type=e,a.user=t,o.emit("hcmessage",JSON.stringify(a)))}function j(e){g=e}function O(e){n||!o||f||p?n=!1:x("camera",{camera:e.toJson()})}function z(e){if(!o||f||s||p)s=!1;else{let e=[],a=hwv.selectionManager.getResults();for(let t=0;t<a.length;t++)e.push(a[t].toJson());x("selection",{selection:e})}}async function F(e,a,t){return!o||f||l||p?l=!1:x("visibility",{nodeids:e,onoff:a}),await i.model.setNodesVisibilityCollab(e,a,t)}async function E(){return!o||f||l||p?l=!1:x("resetvisibilities",{}),await i.model.resetNodesVisibilityCollab()}async function D(e){return!o||f||p||x("setdrawmode",{drawmode:e}),await i.view.setDrawModeCollab(e)}async function I(e){return!o||f||p||x("setprojectionmode",{projectionmode:e}),await i.view.setProjectionModeCollab(e)}async function W(){return!o||f||p||x("reset",{}),await i.model.resetCollab()}async function B(){return!o||f||p||x("clear",{}),await i.model.clearCollab()}async function L(e,a){return!o||f||r||p?r=!1:(a.toJson(),x("matrix",{nodeid:e,matrix:a.toJson()})),await i.model.setNodeMatrixCollab(e,a)}async function _(e,a,t,n){return!o||f||c||p?c=!1:x("isolate",{nodeids:e,duration:a,fitNodes:t,initiallyHidden:n}),await i.view.isolateNodesCollab(e,0,t,n)}async function H(e,a){return!o||f||d||p?d=!1:x("cadview",{nodeid:e,duration:a}),await i.model.activateCadViewCollab(e,a)}async function U(e){return!o||f||u||p?u=!1:x("explodemagnitude",{magnitude:e}),await i.explodeManager.setMagnitudeCollab(e)}function q(e){!o||f||p||x("markup",{id:e.getUniqueId(),info:i.markupManager.exportMarkup()})}function A(){!o||f||p||x("markup",{id:i.markupManager.getActiveMarkupView().getUniqueId(),info:i.markupManager.exportMarkup()})}function G(){!o||f||p||x("markup",{id:null,info:i.markupManager.exportMarkup()})}async function R(e){!o||f||m||p?m=!1:x("activatemarkupview",{id:e}),i.unsetCallbacks({camera:O}),await i.markupManager.activateMarkupViewWithPromiseCollab(e,0),i.setCallbacks({camera:O})}async function T(e,a){!o||f||b||p||x("cuttingsection",{id:e,active:!0,csinfo:a.toJson()}),await a.activateCollab()}async function X(e,a){if(o&&!f&&!b&&!p){x("cuttingsection",{id:e,active:!1,csinfo:a.toJson()})}await a.deactivateCollab()}async function K(e,a,t,i,n,s,l){await a.updatePlaneCollab(t,i,n,s,l),!o||f||b||p||x("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function Q(e,a,t,i,n){await a.setPlaneCollab(t,i,n),!o||f||b||p||x("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function Y(e,a,t){!o||f||p||x("loadsubtree",{a:e,b:a,c:t}),await i.model.loadSubtreeFromScsFileCollab(e,a,t)}function Z(e,a){i=e,v=a,e.setCallbacks({camera:O,selectionArray:z,viewCreated:q,redlineCreated:A,measurementCreated:G}),e.view.setProjectionModeCollab=e.view.setProjectionMode,e.view.setProjectionMode=I,e.view.setDrawModeCollab=e.view.setDrawMode,e.view.setDrawMode=D,e.markupManager.activateMarkupViewWithPromiseCollab=e.markupManager.activateMarkupViewWithPromise,e.markupManager.activateMarkupViewWithPromise=R,e.model.loadSubtreeFromScsFileCollab=e.model.loadSubtreeFromScsFile,e.model.loadSubtreeFromScsFile=Y,e.model.setNodesVisibilityCollab=e.model.setNodesVisibility,e.model.setNodesVisibility=F,e.explodeManager.setMagnitudeCollab=e.explodeManager.setMagnitude,e.explodeManager.setMagnitude=U,e.model.resetNodesVisibilityCollab=e.model.resetNodesVisibility,e.model.resetNodesVisibility=E,e.model.resetCollab=e.model.reset,e.model.reset=W,e.model.clearCollab=e.model.clear,e.model.clear=B,e.model.setNodeMatrixCollab=e.model.setNodeMatrix,e.model.setNodeMatrix=L,e.view.isolateNodesCollab=e.view.isolateNodes,e.view.isolateNodes=_,e.model.activateCadViewCollab=e.model.activateCadView,e.model.activateCadView=H;let t=e.cuttingManager.getCuttingSection(0),n=e.cuttingManager.getCuttingSection(1),s=e.cuttingManager.getCuttingSection(2);if(t.activateCollab=t.activate,t.activate=function(){T(0,this)},n.activateCollab=n.activate,n.activate=function(){T(1,this)},s.activateCollab=s.activate,s.activate=function(){T(2,this)},t.deactivateCollab=t.deactivate,t.deactivate=function(){X(0,this)},n.deactivateCollab=n.deactivate,n.deactivate=function(){X(1,this)},s.deactivateCollab=s.deactivate,s.deactivate=function(){X(2,this)},t.updatePlaneCollab=t.updatePlane,t.updatePlane=function(e,a,t,i,o){K(0,this,e,a,t,i,o)},n.updatePlaneCollab=n.updatePlane,n.updatePlane=function(e,a,t,i,o){K(1,this,e,a,t,i,o)},s.updatePlaneCollab=s.updatePlane,s.updatePlane=function(e,a,t,i,o){K(2,this,e,a,t,i,o)},t.setPlaneCollab=t.setPlane,t.setPlane=function(e,a,t){Q(0,this,e,a,t)},n.setPlaneCollab=n.setPlane,n.setPlane=function(e,a,t){Q(1,this,e,a,t)},s.setPlaneCollab=s.setPlane,s.setPlane=function(e,a,t){Q(2,this,e,a,t)},v){var l=$("#ui-modelbrowser-minimizebutton");l&&l.on("click",(function(){!o||f||p||($(this).hasClass("minimized")?x("minimizebrowser",{}):x("maximizebrowser",{}))}))}}async function ee(e,a){t=a;let c={username:a,roomname:e};(o=await io()).emit("joinroom",JSON.stringify(c)),o.on("hcmessage",(async function(e){let a=JSON.parse(e);switch(g&&g(a),a.type){case"camera":{let e=Communicator.Camera.fromJson(a.camera);n=!0,i.view.setCamera(e)}break;case"setprojectionmode":i.view.setProjectionModeCollab(a.projectionmode);break;case"selection":{let e=a.selection;s=!0,i.selectionManager.clear();let t=[];for(let a=0;a<e.length;a++){let i,o,n;e[a].faceEntity&&(i=Communicator.Selection.FaceEntity.fromJson(e[a].faceEntity)),e[a].lineEntity&&(o=Communicator.Selection.LineEntity.fromJson(e[a].lineEntity)),e[a].pointEntity&&(n=Communicator.Selection.PointEntity.fromJson(e[a].pointEntity));let s=new Communicator.Selection.SelectionItem.create(e[a].nodeId,null,i,o,n);t.push(s)}for(let e=0;e<t.length;e++)s=!0,i.selectionManager.add(t[e])}break;case"setdrawmode":i.view.setDrawModeCollab(a.drawmode);break;case"activatemarkupview":m=!0,i.unsetCallbacks({camera:O}),await i.markupManager.activateMarkupViewWithPromise(a.id,0),i.setCallbacks({camera:O});break;case"markup":i.unsetCallbacks({viewCreated:q}),i.unsetCallbacks({redlineCreated:q}),i.markupManager.deleteMarkupView(a.id),await i.markupManager.loadMarkupData(a.info),a.id&&i.markupManager.activateMarkupView(a.id),i.markupManager.refreshMarkup(),i.setCallbacks({viewCreated:q}),i.setCallbacks({redlineCreated:q});break;case"loadsubtree":hwv.model.loadSubtreeFromScsFileCollab(a.a,a.b,a.c);break;case"visibility":l=!0,i.model.setNodesVisibility(a.nodeids,a.onoff);break;case"explodemagnitude":u=!0,i.explodeManager.setMagnitude(a.magnitude);break;case"resetvisibilities":l=!0,b=!0,i.model.resetNodesVisibility();break;case"reset":i.model.resetCollab();break;case"clear":i.model.clearCollab();break;case"matrix":r=!0,i.model.setNodeMatrix(a.nodeid,Communicator.Matrix.fromJson(a.matrix));break;case"isolate":n=!0,b=!0,await i.view.isolateNodesCollab(a.nodeids,0,null!=a.fitNodes?a.fitNodes:void 0,null!=a.initiallyHidden?a.initiallyHidden:void 0);break;case"cadview":d=!0,i.model.activateCadView(a.nodeid,null!=a.duration?a.duration:void 0);break;case"cuttingsection":{let e=i.cuttingManager.getCuttingSection(a.id);a.active?(b=!0,r=!0,await e.fromJson(a.csinfo)):e.deactivateCollab(),b=!1}break;case"minimizebrowser":v._modelBrowser._minimizeModelBrowser();break;case"maximizebrowser":v._modelBrowser._maximizeModelBrowser()}})),o.on("initialState",(function(e){let a=JSON.parse(e);if(a.camera){let e=Communicator.Camera.fromJson(a.camera);n=!0,i.view.setCamera(e)}a.type="initialState",g&&g(a)})),o.on("sendInitialState",(function(e){let a={camera:i.view.getCamera().toJson()};o.emit("initialState",JSON.stringify({recepient:e,state:a})),g&&g({recepient:e,type:"sendInitialState"})})),o.on("lockSession",(function(e){w=e,p=!0,g&&g({user:e,type:"lockSession"})})),o.on("unlockSession",(function(e){p=!1,g&&g({type:"unlockSession"})})),o.on("disconnected",(function(e){e==w&&1==p&&(w="",p=!1),g&&g({user:e,type:"disconnected"})})),o.on("chatmessage",(function(e){let a=JSON.parse(e);a.type="chatmessage",g&&g(a)})),o.on("userlist",(function(e){let a=JSON.parse(e);a.type="userlist",g&&g(a)}))}var ae=a.$j,te=a.zP,ie=a.CS,oe=a.pw,ne=a.vy,se=a.j2,le=a.$T,re=a.dj,ce=a.O5,de=a.XG,ue=a.Vt,me=a.f4;export{ae as connect,te as disconnect,ie as getLocalUser,oe as getLockedClient,ne as getLockedMaster,se as initialize,le as lockSession,re as sendCustomMessage,ce as setMessageReceivedCallback,de as setSuspendSend,ue as submitChat,me as unlockSession};