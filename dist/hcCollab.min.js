var hcCollab;(()=>{"use strict";var e={d:(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};e.r(a),e.d(a,{connect:()=>te,disconnect:()=>w,getActive:()=>f,getLocalUser:()=>p,getLockedClient:()=>g,getLockedMaster:()=>y,getSuspendSend:()=>S,initialize:()=>ae,lockSession:()=>v,sendCustomMessage:()=>h,setMessageReceivedCallback:()=>P,setSuspendSend:()=>N,submitChat:()=>M,unlockSession:()=>k});var t,i,o,n=null,l=!1,s=!1,c=!1,r=!1,d="",u=null,m=null,b=[],C=!1;function f(){return!!n}function w(){n&&(n.disconnect(),n=null),c=!1,r=!1}function p(){if(n)return{id:n.id,name:t}}function y(){return c}function g(){return r}function v(){!n||c||r||n.emit("lockSession",""),c=!0}function k(){n&&c&&n.emit("unlockSession",""),c=!1}function M(e){n.emit("chatmessage",JSON.stringify({user:t,message:e}))}function N(e){l=e}function S(){return l}function h(e){n&&(e.type="custommessage",e.user=t,n.emit("hcmessage",JSON.stringify(e)))}function P(e){m=e}function J(e,a){n&&(a.type=e,a.user=t,n.emit("hcmessage",JSON.stringify(a)))}function O(e){s||!n||l||r||J("camera",{camera:e.toJson()})}function x(e){if(n&&!l&&!s&&!r){let e=[],a=hwv.selectionManager.getResults();for(let t=0;t<a.length;t++)e.push(a[t].toJson());J("selection",{selection:e})}}async function V(e,a,t){return!n||l||s||r||J("visibility",{nodeids:e,onoff:a}),await i.model.setNodesVisibilityCollab(e,a,t)}async function F(e,a){!n||l||s||r||J("facecolor",{nodeids:e,color:a.toJson()}),await i.model.setNodesFaceColorCollab(e,a)}async function I(e){return!n||l||s||r||J("unsetfacecolor",{nodeids:e}),await i.model.unsetNodesFaceColorCollab(e)}async function j(e,a){return!n||l||s||r||J("opacity",{nodeids:e,opacity:a}),await i.model.setNodesOpacityCollab(e,a)}async function z(e){return!n||l||s||r||J("resetopacity",{nodeids:e}),await i.model.resetNodesOpacityCollab(e)}async function E(e,a,t){return!n||l||s||r||J("setInstanceModifier",{a:e,b:a,c:t}),await i.model.setInstanceModifierCollab(e,a,t)}async function D(){return!n||l||s||r||J("resetvisibilities",{}),await i.model.resetNodesVisibilityCollab()}async function _(e){return!n||l||s||r||J("setdrawmode",{drawmode:e}),await i.view.setDrawModeCollab(e)}async function L(e){return!n||l||s||r||J("setprojectionmode",{projectionmode:e}),await i.view.setProjectionModeCollab(e)}async function W(){return!n||l||s||r||J("reset",{}),await i.model.resetCollab()}async function B(){return!n||l||s||r||J("clear",{}),await i.model.clearCollab()}async function A(e,a){return!n||l||s||r||(a.toJson(),J("matrix",{nodeid:e,matrix:a.toJson()})),await i.model.setNodeMatrixCollab(e,a)}async function H(e,a,t,o){return!n||l||s||r||J("isolate",{nodeids:e,duration:a,fitNodes:t,initiallyHidden:o}),await i.view.isolateNodesCollab(e,0,t,o)}async function U(e,a){return!n||l||s||r||J("cadview",{nodeid:e,duration:a}),await i.model.activateCadViewCollab(e,0)}async function q(e){return!n||l||s||r||J("explodemagnitude",{magnitude:e}),await i.explodeManager.setMagnitudeCollab(e)}function R(e){!n||l||s||r||J("markup",{id:e.getUniqueId(),info:i.markupManager.exportMarkup()})}function T(){!n||l||s||r||J("markup",{id:i.markupManager.getActiveMarkupView().getUniqueId(),info:i.markupManager.exportMarkup()})}function G(){!n||l||s||r||J("markup",{id:null,info:i.markupManager.exportMarkup()})}async function K(e){!n||l||s||r||J("activatemarkupview",{id:e}),i.unsetCallbacks({camera:O}),await i.markupManager.activateMarkupViewWithPromiseCollab(e,0),i.setCallbacks({camera:O})}async function Q(e,a){!n||l||s||r||J("cuttingsection",{id:e,active:!0,csinfo:a.toJson()}),await a.activateCollab()}async function X(e,a){!n||l||s||r||J("cuttingsection",{id:e,active:!1,csinfo:a.toJson()}),await a.deactivateCollab()}async function Y(e,a,t,i,o,c,d){await a.updatePlaneCollab(t,i,o,c,d),!n||l||s||r||J("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function Z(e,a,t,i,o){await a.setPlaneCollab(t,i,o),!n||l||s||r||J("cuttingsection",{id:e,active:!0,csinfo:a.toJson()})}async function ee(e,a,t){!n||l||s||r||J("loadsubtree",{a:e,b:a,c:t}),await i.model.loadSubtreeFromScsFileCollab(e,a,t)}function ae(e,a,t){o=t,i=e,u=a,e.setCallbacks({camera:O,selectionArray:x,viewCreated:R,redlineCreated:T,measurementCreated:G}),e.view.setProjectionModeCollab=e.view.setProjectionMode,e.view.setProjectionMode=L,e.view.setDrawModeCollab=e.view.setDrawMode,e.view.setDrawMode=_,e.markupManager.activateMarkupViewWithPromiseCollab=e.markupManager.activateMarkupViewWithPromise,e.markupManager.activateMarkupViewWithPromise=K,e.model.loadSubtreeFromScsFileCollab=e.model.loadSubtreeFromScsFile,e.model.loadSubtreeFromScsFile=ee,e.model.setNodesVisibilityCollab=e.model.setNodesVisibility,e.model.setNodesVisibility=V,e.model.setNodesFaceColorCollab=e.model.setNodesFaceColor,e.model.setNodesFaceColor=F,e.model.unsetNodesFaceColorCollab=e.model.unsetNodesFaceColor,e.model.unsetNodesFaceColor=I,e.model.setNodesOpacityCollab=e.model.setNodesOpacity,e.model.setNodesOpacity=j,e.model.resetNodesOpacityCollab=e.model.resetNodesOpacity,e.model.resetNodesOpacity=z,e.model.setInstanceModifierCollab=e.model.setInstanceModifier,e.model.setInstanceModifier=E,e.explodeManager.setMagnitudeCollab=e.explodeManager.setMagnitude,e.explodeManager.setMagnitude=q,e.model.resetNodesVisibilityCollab=e.model.resetNodesVisibility,e.model.resetNodesVisibility=D,e.model.resetCollab=e.model.reset,e.model.reset=W,e.model.clearCollab=e.model.clear,e.model.clear=B,e.model.setNodeMatrixCollab=e.model.setNodeMatrix,e.model.setNodeMatrix=A,e.view.isolateNodesCollab=e.view.isolateNodes,e.view.isolateNodes=H,e.model.activateCadViewCollab=e.model.activateCadView,e.model.activateCadView=U;let s=e.cuttingManager.getCuttingSection(0),c=e.cuttingManager.getCuttingSection(1),d=e.cuttingManager.getCuttingSection(2);if(s&&(s.activateCollab=s.activate,s.activate=function(){Q(0,this)},s.deactivateCollab=s.deactivate,s.deactivate=function(){X(0,this)},s.updatePlaneCollab=s.updatePlane,s.updatePlane=function(e,a,t,i,o){Y(0,this,e,a,t,i,o)},s.setPlaneCollab=s.setPlane,s.setPlane=function(e,a,t){Z(0,this,e,a,t)}),c&&(c.activateCollab=c.activate,c.activate=function(){Q(1,this)},c.deactivateCollab=c.deactivate,c.deactivate=function(){X(1,this)},c.updatePlaneCollab=c.updatePlane,c.updatePlane=function(e,a,t,i,o){Y(1,this,e,a,t,i,o)},c.setPlaneCollab=c.setPlane,c.setPlane=function(e,a,t){Z(1,this,e,a,t)}),d&&(d.activateCollab=d.activate,d.activate=function(){Q(2,this)},d.deactivateCollab=d.deactivate,d.deactivate=function(){X(2,this)},d.updatePlaneCollab=d.updatePlane,d.updatePlane=function(e,a,t,i,o){Y(2,this,e,a,t,i,o)},d.setPlaneCollab=d.setPlane,d.setPlane=function(e,a,t){Z(2,this,e,a,t)}),u){var m=$("#ui-modelbrowser-minimizebutton");m&&m.on("click",(function(){!n||l||r||($(this).hasClass("minimized")?J("minimizebrowser",{}):J("maximizebrowser",{}))}))}}async function te(e,a,l){t=a;let c={username:a,roomname:e,password:l};(n=await io(o)).emit("joinroom",JSON.stringify(c)),n.on("hcmessage",(async function(e){let a=JSON.parse(e);m&&!m(a)||"custommessage"===a.type||function(e){b.push(e);{let e=setInterval((async function(){if(b.length>0){if(!C){C=!0;let e=b.shift();await async function(e){switch(s=!0,e.type){case"camera":{let a=Communicator.Camera.fromJson(e.camera);await i.view.setCamera(a)}break;case"setprojectionmode":await i.view.setProjectionModeCollab(e.projectionmode);break;case"selection":{let a=e.selection;i.selectionManager.clear();let t=[];for(let e=0;e<a.length;e++){let i,o,n;a[e].faceEntity&&(i=Communicator.Selection.FaceEntity.fromJson(a[e].faceEntity)),a[e].lineEntity&&(o=Communicator.Selection.LineEntity.fromJson(a[e].lineEntity)),a[e].pointEntity&&(n=Communicator.Selection.PointEntity.fromJson(a[e].pointEntity));let l=new Communicator.Selection.SelectionItem.create(a[e].nodeId,null,i,o,n);t.push(l)}for(let e=0;e<t.length;e++)await i.selectionManager.add(t[e])}break;case"setdrawmode":await i.view.setDrawModeCollab(e.drawmode);break;case"activatemarkupview":i.unsetCallbacks({camera:O}),await i.markupManager.activateMarkupViewWithPromise(e.id,0),i.setCallbacks({camera:O});break;case"markup":i.unsetCallbacks({viewCreated:R}),i.unsetCallbacks({redlineCreated:R}),i.markupManager.deleteMarkupView(e.id),await i.markupManager.loadMarkupData(e.info),e.id&&i.markupManager.activateMarkupView(e.id),i.markupManager.refreshMarkup(),i.setCallbacks({viewCreated:R}),i.setCallbacks({redlineCreated:R});break;case"loadsubtree":i.unsetCallbacks({camera:O}),await hwv.model.loadSubtreeFromScsFileCollab(e.a,e.b,e.c),i.setCallbacks({camera:O});break;case"visibility":await i.model.setNodesVisibilityCollab(e.nodeids,e.onoff);break;case"opacity":await i.model.setNodesOpacityCollab(e.nodeids,e.opacity);break;case"facecolor":try{await i.model.setNodesFaceColorCollab(e.nodeids,Communicator.Color.fromJson(e.color))}catch(e){}break;case"unsetfacecolor":try{await i.model.unsetNodesFaceColorCollab(e.nodeids)}catch(e){}break;case"resetopacity":await i.model.resetNodesOpacityCollab(e.nodeids,e.opacity);break;case"setInstanceModifier":await i.model.setInstanceModifierCollab(e.a,e.b,e.c);break;case"explodemagnitude":await i.explodeManager.setMagnitudeCollab(e.magnitude);break;case"resetvisibilities":await i.model.resetNodesVisibilityCollab();break;case"reset":i.model.resetCollab();break;case"clear":i.unsetCallbacks({camera:O}),await i.model.clearCollab(),i.setCallbacks({camera:O});break;case"matrix":await i.model.setNodeMatrixCollab(e.nodeid,Communicator.Matrix.fromJson(e.matrix));break;case"isolate":await i.view.isolateNodesCollab(e.nodeids,0,null!=e.fitNodes?e.fitNodes:void 0,null!=e.initiallyHidden?e.initiallyHidden:void 0);break;case"cadview":await i.model.activateCadViewCollab(e.nodeid,0);break;case"cuttingsection":{let a=i.cuttingManager.getCuttingSection(e.id);e.active?await a.fromJson(e.csinfo):a.deactivateCollab()}break;case"minimizebrowser":await u._modelBrowser._minimizeModelBrowser();break;case"maximizebrowser":await u._modelBrowser._maximizeModelBrowser()}s=!1}(e),C=!1}}else clearInterval(e),e=null}),10)}}(a)})),n.on("initialState",(function(e){let a=JSON.parse(e);if(a.type="initialState",(!m||m(a))&&a.camera){let e=Communicator.Camera.fromJson(a.camera);i.view.setCamera(e)}})),n.on("sendInitialState",(function(e){let a={type:"sendInitialState",camera:i.view.getCamera().toJson()};m&&!m(a)||n.emit("initialState",JSON.stringify({recepient:e,state:a}))})),n.on("lockSession",(function(e){m&&!m({user:e,type:"lockSession"})||(d=e,r=!0)})),n.on("unlockSession",(function(e){m&&!m({type:"unlockSession"})||(r=!1)})),n.on("disconnect",(()=>{d="",r=!1,w(),m&&m({type:"connectionLost"})})),n.on("disconnected",(function(e){e==d&&1==r&&(d="",r=!1),m&&m({user:e,type:"disconnected"})})),n.on("chatmessage",(function(e){let a=JSON.parse(e);a.type="chatmessage",m&&m(a)})),n.on("userlist",(function(e){let a=JSON.parse(e);a.type="userlist",m&&m(a)}))}hcCollab=a})();